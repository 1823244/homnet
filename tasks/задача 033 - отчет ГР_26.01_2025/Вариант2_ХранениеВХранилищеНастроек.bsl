// ВАРИАНТ 2: Хранение списков контрагентов в Хранилище Общих Настроек
// Используется стандартное хранилище 1С для настроек

#Область ВариантХранения_ВХранилищеОбщихНастроек

// Назначение: Сохранение списка контрагентов в хранилище настроек
// Параметры: ИдентификаторСписка – Строка – Уникальный идентификатор списка;
//            МассивКонтрагентов – Массив – Массив ссылок на контрагентов;
//            Описание – Строка – Описание списка для пользователя
// Операции с БД: Запись в хранилище общих настроек
Процедура СохранитьСписокКонтрагентовВХранилище(ИдентификаторСписка, МассивКонтрагентов, Описание = "") Экспорт

	#region initialization
	
	КлючОбъекта = "ГР_26_01_2025";
	КлючНастроек = ИдентификаторСписка;
	
	// Создаем структуру для хранения
	Настройки = Новый Структура;
	Настройки.Вставить("Описание", Описание);
	Настройки.Вставить("ДатаИзменения", ТекущаяДата());
	Настройки.Вставить("Контрагенты", Новый Массив);
	
	#endregion
	
	#region data_processing
	
	// Сохраняем контрагентов в виде структур с именем и ссылкой
	Для Каждого Контрагент Из МассивКонтрагентов Цикл
		
		Если ЗначениеЗаполнено(Контрагент) Тогда
			
			КонтрагентСтруктура = Новый Структура;
			КонтрагентСтруктура.Вставить("Наименование", Строка(Контрагент));
			КонтрагентСтруктура.Вставить("Ссылка", Контрагент);
			
			Настройки.Контрагенты.Добавить(КонтрагентСтруктура);
			
		КонецЕсли;
		
	КонецЦикла;
	
	#endregion
	
	#region database_write
	
	// Сохраняем в хранилище общих настроек
	// Параметры: Ключ объекта, Настройки, Описание настроек, Пользователь (Неопределено = для всех)
	ХранилищеОбщихНастроек.Сохранить(КлючОбъекта, КлючНастроек, Настройки);
	
	#endregion

КонецПроцедуры

// Назначение: Получение списка контрагентов из хранилища настроек
// Параметры: ИдентификаторСписка – Строка – Уникальный идентификатор списка
// Возвращаемое: Массив – Массив ссылок на контрагентов
Функция ПолучитьСписокКонтрагентовИзХранилища(ИдентификаторСписка) Экспорт

	#region initialization
	
	МассивКонтрагентов = Новый Массив;
	КлючОбъекта = "ГР_26_01_2025";
	КлючНастроек = ИдентификаторСписка;
	
	#endregion
	
	#region database_query
	
	// Загружаем настройки из хранилища
	Настройки = ХранилищеОбщихНастроек.Загрузить(КлючОбъекта, КлючНастроек);
	
	#endregion
	
	#region data_processing
	
	Если Настройки <> Неопределено И ТипЗнч(Настройки) = Тип("Структура") Тогда
		
		Если Настройки.Свойство("Контрагенты") Тогда
			
			Для Каждого КонтрагентСтруктура Из Настройки.Контрагенты Цикл
				
				Если ТипЗнч(КонтрагентСтруктура) = Тип("Структура")
					И КонтрагентСтруктура.Свойство("Ссылка") Тогда
					
					Если ЗначениеЗаполнено(КонтрагентСтруктура.Ссылка) Тогда
						МассивКонтрагентов.Добавить(КонтрагентСтруктура.Ссылка);
					КонецЕсли;
					
				КонецЕсли;
				
			КонецЦикла;
			
		КонецЕсли;
		
	КонецЕсли;
	
	#endregion
	
	#region result_formation
	
	Возврат МассивКонтрагентов;
	
	#endregion

КонецФункции

// Назначение: Инициализация всех списков контрагентов в хранилище
Процедура ИнициализироватьСпискиКонтрагентовВХранилище() Экспорт

	#region initialization
	
	#endregion
	
	#region data_processing
	
	// Строка 1 - ИТ-услуги
	МассивКонтрагентов = Новый Массив;
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("АБИСОФТ ООО", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("АБИУС ООО", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("АЙТИ ЛАЙТ ООО", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("АКРИБИЯ. ПРОЕКТЫ И СЕРВИС ООО", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("ВИНВЕСТОР АО", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("ВЫМПЕЛКОМ ПАО", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("МАКОМНЕТ АО", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("МАСТЕРТЕЛ АО", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("МБ ЗАЩИТА ИНФОРМАЦИИ ООО", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("МЕГАФОН ПАО", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("ПАО МОСКОВСКАЯ БИРЖА", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("РНД СОФТ ООО", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("РОСТЕЛЕКОМ ПАО", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("СИНТЕГС ООО", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("СКРИН МАРКЕТ СИСТЕМЗ ООО", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("ТУРБО ТЕХНОЛОГИИ ООО", Истина));
	СохранитьСписокКонтрагентовВХранилище("Стр1_ИТУслуги", МассивКонтрагентов, "Контрагенты по ИТ-услугам");
	
	// Строка 2 - Аренда помещений
	МассивКонтрагентов = Новый Массив;
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("АПОЛЛО КОНСТРАКШН ООО", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("ВАЛОВАЯ 37 ООО", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("УК ЛЕРТА КАПИТАЛ ООО", Истина));
	СохранитьСписокКонтрагентовВХранилище("Стр2_АрендаПомещений", МассивКонтрагентов, "Контрагенты по аренде помещений");
	
	// Строка 3 - Депозитарии
	МассивКонтрагентов = Новый Массив;
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("НКО АО НРД", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("РАЙФФАЙЗЕНБАНК АО", Истина));
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("ТБАНК АО", Истина));
	СохранитьСписокКонтрагентовВХранилище("Стр3_Депозитарии", МассивКонтрагентов, "Контрагенты-депозитарии");
	
	// Строка 20 - Банк ГПБ
	МассивКонтрагентов = Новый Массив;
	МассивКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоНаименованию("Банк ГПБ (АО)", Истина));
	СохранитьСписокКонтрагентовВХранилище("Стр20_БанкГПБ", МассивКонтрагентов, "Контрагент Банк ГПБ");
	
	#endregion

КонецПроцедуры

// Назначение: Удаление списка контрагентов из хранилища
// Параметры: ИдентификаторСписка – Строка – Уникальный идентификатор списка
Процедура УдалитьСписокКонтрагентовИзХранилища(ИдентификаторСписка) Экспорт

	#region initialization
	
	КлючОбъекта = "ГР_26_01_2025";
	КлючНастроек = ИдентификаторСписка;
	
	#endregion
	
	#region database_write
	
	ХранилищеОбщихНастроек.Удалить(КлючОбъекта, КлючНастроек, Неопределено);
	
	#endregion

КонецПроцедуры

// Назначение: Получение списка всех сохраненных настроек контрагентов
// Возвращаемое: Массив – Массив структур с информацией о списках
Функция ПолучитьСписокВсехНастроекКонтрагентов() Экспорт

	#region initialization
	
	КлючОбъекта = "ГР_26_01_2025";
	Результат = Новый Массив;
	
	#endregion
	
	#region database_query
	
	// Получаем список всех настроек для объекта
	СписокНастроек = ХранилищеОбщихНастроек.ПолучитьСписок(КлючОбъекта);
	
	#endregion
	
	#region data_processing
	
	Для Каждого Настройка Из СписокНастроек Цикл
		
		// Загружаем каждую настройку
		ЗначениеНастройки = ХранилищеОбщихНастроек.Загрузить(КлючОбъекта, Настройка.Значение);
		
		Если ЗначениеНастройки <> Неопределено И ТипЗнч(ЗначениеНастройки) = Тип("Структура") Тогда
			
			ИнфоСтруктура = Новый Структура;
			ИнфоСтруктура.Вставить("Ключ", Настройка.Значение);
			ИнфоСтруктура.Вставить("Представление", Настройка.Представление);
			
			Если ЗначениеНастройки.Свойство("Описание") Тогда
				ИнфоСтруктура.Вставить("Описание", ЗначениеНастройки.Описание);
			Иначе
				ИнфоСтруктура.Вставить("Описание", "");
			КонецЕсли;
			
			Если ЗначениеНастройки.Свойство("ДатаИзменения") Тогда
				ИнфоСтруктура.Вставить("ДатаИзменения", ЗначениеНастройки.ДатаИзменения);
			Иначе
				ИнфоСтруктура.Вставить("ДатаИзменения", Дата(1, 1, 1));
			КонецЕсли;
			
			Если ЗначениеНастройки.Свойство("Контрагенты") Тогда
				ИнфоСтруктура.Вставить("КоличествоКонтрагентов", ЗначениеНастройки.Контрагенты.Количество());
			Иначе
				ИнфоСтруктура.Вставить("КоличествоКонтрагентов", 0);
			КонецЕсли;
			
			Результат.Добавить(ИнфоСтруктура);
			
		КонецЕсли;
		
	КонецЦикла;
	
	#endregion
	
	#region result_formation
	
	Возврат Результат;
	
	#endregion

КонецФункции

// ОБНОВЛЕННЫЕ функции получения контрагентов

// Назначение: Получение массива контрагентов для строки 1 из хранилища
// Возвращаемое: Массив – Массив ссылок на контрагентов
Функция ПолучитьКонтрагентов_Стр1_ИТУслуги() Экспорт
	
	Возврат ПолучитьСписокКонтрагентовИзХранилища("Стр1_ИТУслуги");

КонецФункции

// Назначение: Получение массива контрагентов для строки 2 из хранилища
// Возвращаемое: Массив – Массив ссылок на контрагентов
Функция ПолучитьКонтрагентов_Стр2_АрендаПомещений() Экспорт
	
	Возврат ПолучитьСписокКонтрагентовИзХранилища("Стр2_АрендаПомещений");

КонецФункции

// Назначение: Получение массива контрагентов для строки 3 из хранилища
// Возвращаемое: Массив – Массив ссылок на контрагентов
Функция ПолучитьКонтрагентов_Стр3_Депозитарии() Экспорт
	
	Возврат ПолучитьСписокКонтрагентовИзХранилища("Стр3_Депозитарии");

КонецФункции

// Назначение: Получение массива контрагентов для строки 20 из хранилища
// Возвращаемое: Массив – Массив ссылок на контрагентов
Функция ПолучитьКонтрагентов_Стр20_БанкГПБ() Экспорт
	
	Возврат ПолучитьСписокКонтрагентовИзХранилища("Стр20_БанкГПБ");

КонецФункции

#КонецОбласти

// ====================================
// ПРЕИМУЩЕСТВА ВАРИАНТА 2:
// ====================================
// ✅ Простая реализация - стандартный механизм 1С
// ✅ Не создает лишних объектов в справочнике
// ✅ Быстрый доступ к данным
// ✅ Легко создать форму редактирования списков
// ✅ Можно хранить дополнительные данные (описание, дата изменения)
// ✅ Легко получить список всех настроек
// ✅ Легко удалить ненужные списки
// ✅ Автоматически доступно всем пользователям
// ✅ Не требует изменений в конфигурации

// НЕДОСТАТКИ:
// ❌ Данные не видны в конфигураторе напрямую
// ❌ Сложнее настроить права доступа (только через RLS на уровне БД)
// ❌ Нужна отдельная обработка для просмотра/редактирования

// РЕКОМЕНДАЦИЯ: 
// 🎯 Вариант 2 (Хранилище общих настроек) - ПРЕДПОЧТИТЕЛЬНЫЙ
// Причины:
// - Проще в реализации и поддержке
// - Не засоряет справочник показателей
// - Гибкость в хранении дополнительных данных
// - Стандартный механизм 1С
