// ФОРМА ДЛЯ РЕДАКТИРОВАНИЯ СПИСКОВ КОНТРАГЕНТОВ
// Может быть создана как обработка или как форма обработки

// ===== ЧАСТЬ 1: МОДУЛЬ ФОРМЫ =====

#Область ОбработчикиСобытийФормы

// Назначение: Обработчик события при создании формы на сервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

	#region initialization
	
	ЗагрузитьСпискиНастроек();
	
	#endregion

КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

// Назначение: Загрузить список контрагентов для редактирования
Процедура ЗагрузитьСписок(Команда)

	#region validation
	
	Если НЕ ЗначениеЗаполнено(ТекущийКлючСписка) Тогда
		Сообщить("Выберите список для редактирования");
		Возврат;
	КонецЕсли;
	
	#endregion
	
	#region data_processing
	
	ЗагрузитьСписокКонтрагентовНаСервере(ТекущийКлючСписка);
	
	#endregion

КонецПроцедуры

// Назначение: Сохранить изменения в списке контрагентов
Процедура СохранитьСписок(Команда)

	#region validation
	
	Если НЕ ЗначениеЗаполнено(ТекущийКлючСписка) Тогда
		Сообщить("Выберите список для сохранения");
		Возврат;
	КонецЕсли;
	
	#endregion
	
	#region data_processing
	
	СохранитьСписокКонтрагентовНаСервере(ТекущийКлючСписка);
	Сообщить("Список контрагентов сохранен");
	
	#endregion

КонецПроцедуры

// Назначение: Добавить контрагента в список
Процедура ДобавитьКонтрагента(Команда)

	#region data_processing
	
	НоваяСтрока = СписокКонтрагентов.Добавить();
	НоваяСтрока.НомерСтроки = СписокКонтрагентов.Количество();
	
	#endregion

КонецПроцедуры

// Назначение: Удалить контрагента из списка
Процедура УдалитьКонтрагента(Команда)

	#region validation
	
	ТекущиеДанные = Элементы.СписокКонтрагентов.ТекущиеДанные;
	
	Если ТекущиеДанные = Неопределено Тогда
		Сообщить("Выберите строку для удаления");
		Возврат;
	КонецЕсли;
	
	#endregion
	
	#region data_processing
	
	СписокКонтрагентов.Удалить(ТекущиеДанные);
	
	// Перенумеруем строки
	Счетчик = 1;
	Для Каждого Строка Из СписокКонтрагентов Цикл
		Строка.НомерСтроки = Счетчик;
		Счетчик = Счетчик + 1;
	КонецЦикла;
	
	#endregion

КонецПроцедуры

// Назначение: Создать новый список контрагентов
Процедура СоздатьНовыйСписок(Команда)

	#region initialization
	
	НовыйКлюч = "";
	НовоеОписание = "";
	
	#endregion
	
	#region user_interaction
	
	// Здесь нужно открыть диалог ввода ключа и описания
	// Для примера используем простой ввод
	
	#endregion
	
	#region validation
	
	Если ПустаяСтрока(НовыйКлюч) Тогда
		Сообщить("Необходимо указать ключ списка");
		Возврат;
	КонецЕсли;
	
	#endregion
	
	#region data_processing
	
	СоздатьНовыйСписокНаСервере(НовыйКлюч, НовоеОписание);
	ЗагрузитьСпискиНастроек();
	
	#endregion

КонецПроцедуры

// Назначение: Удалить список контрагентов
Процедура УдалитьСписок(Команда)

	#region validation
	
	Если НЕ ЗначениеЗаполнено(ТекущийКлючСписка) Тогда
		Сообщить("Выберите список для удаления");
		Возврат;
	КонецЕсли;
	
	#endregion
	
	#region user_interaction
	
	Ответ = Вопрос("Удалить список """ + ТекущийКлючСписка + """?", РежимДиалогаВопрос.ДаНет);
	
	Если Ответ = КодВозвратаДиалога.Нет Тогда
		Возврат;
	КонецЕсли;
	
	#endregion
	
	#region data_processing
	
	УдалитьСписокНаСервере(ТекущийКлючСписка);
	ТекущийКлючСписка = "";
	СписокКонтрагентов.Очистить();
	ЗагрузитьСпискиНастроек();
	Сообщить("Список удален");
	
	#endregion

КонецПроцедуры

// Назначение: Обновить список настроек
Процедура ОбновитьСписокНастроек(Команда)

	#region data_processing
	
	ЗагрузитьСпискиНастроек();
	
	#endregion

КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Назначение: Загрузка списка всех настроек контрагентов
Процедура ЗагрузитьСпискиНастроек()

	#region initialization
	
	СписокНастроек.Очистить();
	
	#endregion
	
	#region database_query
	
	// ВАРИАНТ 2: Из хранилища общих настроек
	КлючОбъекта = "ГР_26_01_2025";
	МассивНастроек = ХранилищеОбщихНастроек.ПолучитьСписок(КлючОбъекта);
	
	#endregion
	
	#region data_processing
	
	Для Каждого Настройка Из МассивНастроек Цикл
		
		ЗначениеНастройки = ХранилищеОбщихНастроек.Загрузить(КлючОбъекта, Настройка.Значение);
		
		Если ЗначениеНастройки <> Неопределено И ТипЗнч(ЗначениеНастройки) = Тип("Структура") Тогда
			
			НоваяСтрока = СписокНастроек.Добавить();
			НоваяСтрока.Ключ = Настройка.Значение;
			
			Если ЗначениеНастройки.Свойство("Описание") Тогда
				НоваяСтрока.Описание = ЗначениеНастройки.Описание;
			Иначе
				НоваяСтрока.Описание = "";
			КонецЕсли;
			
			Если ЗначениеНастройки.Свойство("ДатаИзменения") Тогда
				НоваяСтрока.ДатаИзменения = ЗначениеНастройки.ДатаИзменения;
			КонецЕсли;
			
			Если ЗначениеНастройки.Свойство("Контрагенты") Тогда
				НоваяСтрока.Количество = ЗначениеНастройки.Контрагенты.Количество();
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЦикла;
	
	#endregion

КонецПроцедуры

// Назначение: Загрузка списка контрагентов для редактирования
// Параметры: КлючСписка – Строка – Ключ настройки
Процедура ЗагрузитьСписокКонтрагентовНаСервере(КлючСписка)

	#region initialization
	
	СписокКонтрагентов.Очистить();
	КлючОбъекта = "ГР_26_01_2025";
	
	#endregion
	
	#region database_query
	
	Настройки = ХранилищеОбщихНастроек.Загрузить(КлючОбъекта, КлючСписка);
	
	#endregion
	
	#region data_processing
	
	Если Настройки <> Неопределено И ТипЗнч(Настройки) = Тип("Структура") Тогда
		
		Если Настройки.Свойство("Описание") Тогда
			ОписаниеСписка = Настройки.Описание;
		КонецЕсли;
		
		Если Настройки.Свойство("Контрагенты") Тогда
			
			Счетчик = 1;
			Для Каждого КонтрагентСтруктура Из Настройки.Контрагенты Цикл
				
				Если ТипЗнч(КонтрагентСтруктура) = Тип("Структура")
					И КонтрагентСтруктура.Свойство("Ссылка") Тогда
					
					НоваяСтрока = СписокКонтрагентов.Добавить();
					НоваяСтрока.НомерСтроки = Счетчик;
					НоваяСтрока.Контрагент = КонтрагентСтруктура.Ссылка;
					
					Счетчик = Счетчик + 1;
					
				КонецЕсли;
				
			КонецЦикла;
			
		КонецЕсли;
		
	КонецЕсли;
	
	#endregion

КонецПроцедуры

// Назначение: Сохранение списка контрагентов
// Параметры: КлючСписка – Строка – Ключ настройки
Процедура СохранитьСписокКонтрагентовНаСервере(КлючСписка)

	#region initialization
	
	КлючОбъекта = "ГР_26_01_2025";
	МассивКонтрагентов = Новый Массив;
	
	#endregion
	
	#region data_processing
	
	// Формируем массив из таблицы формы
	Для Каждого Строка Из СписокКонтрагентов Цикл
		
		Если ЗначениеЗаполнено(Строка.Контрагент) Тогда
			МассивКонтрагентов.Добавить(Строка.Контрагент);
		КонецЕсли;
		
	КонецЦикла;
	
	// Создаем структуру настроек
	Настройки = Новый Структура;
	Настройки.Вставить("Описание", ОписаниеСписка);
	Настройки.Вставить("ДатаИзменения", ТекущаяДата());
	Настройки.Вставить("Контрагенты", Новый Массив);
	
	Для Каждого Контрагент Из МассивКонтрагентов Цикл
		
		КонтрагентСтруктура = Новый Структура;
		КонтрагентСтруктура.Вставить("Наименование", Строка(Контрагент));
		КонтрагентСтруктура.Вставить("Ссылка", Контрагент);
		
		Настройки.Контрагенты.Добавить(КонтрагентСтруктура);
		
	КонецЦикла;
	
	#endregion
	
	#region database_write
	
	ХранилищеОбщихНастроек.Сохранить(КлючОбъекта, КлючСписка, Настройки);
	
	#endregion

КонецПроцедуры

// Назначение: Создание нового списка контрагентов
// Параметры: Ключ – Строка – Ключ нового списка; Описание – Строка – Описание списка
Процедура СоздатьНовыйСписокНаСервере(Ключ, Описание)

	#region initialization
	
	КлючОбъекта = "ГР_26_01_2025";
	
	Настройки = Новый Структура;
	Настройки.Вставить("Описание", Описание);
	Настройки.Вставить("ДатаИзменения", ТекущаяДата());
	Настройки.Вставить("Контрагенты", Новый Массив);
	
	#endregion
	
	#region database_write
	
	ХранилищеОбщихНастроек.Сохранить(КлючОбъекта, Ключ, Настройки);
	
	#endregion

КонецПроцедуры

// Назначение: Удаление списка контрагентов
// Параметры: КлючСписка – Строка – Ключ настройки для удаления
Процедура УдалитьСписокНаСервере(КлючСписка)

	#region initialization
	
	КлючОбъекта = "ГР_26_01_2025";
	
	#endregion
	
	#region database_write
	
	ХранилищеОбщихНастроек.Удалить(КлючОбъекта, КлючСписка, Неопределено);
	
	#endregion

КонецПроцедуры

#КонецОбласти

// ===== ЧАСТЬ 2: ОПИСАНИЕ РЕКВИЗИТОВ ФОРМЫ =====

// РЕКВИЗИТЫ ФОРМЫ:
//
// 1. ТекущийКлючСписка - Строка - Текущий выбранный ключ списка
// 2. ОписаниеСписка - Строка - Описание текущего списка
//
// ТАБЛИЧНЫЕ ЧАСТИ:
//
// 1. СписокНастроек (ТаблицаЗначений):
//    - Ключ - Строка
//    - Описание - Строка
//    - ДатаИзменения - Дата
//    - Количество - Число
//
// 2. СписокКонтрагентов (ТаблицаЗначений):
//    - НомерСтроки - Число
//    - Контрагент - СправочникСсылка.Контрагенты

// ===== ЧАСТЬ 3: ОПИСАНИЕ ЭЛЕМЕНТОВ ФОРМЫ =====

// ЭЛЕМЕНТЫ ФОРМЫ:
//
// 1. Группа "ГруппаНастроек" (слева):
//    - Таблица "СписокНастроек"
//    - Кнопки: "ОбновитьСписокНастроек", "СоздатьНовыйСписок", "УдалитьСписок"
//
// 2. Группа "ГруппаРедактирования" (справа):
//    - Поле "ТекущийКлючСписка" (только чтение)
//    - Поле "ОписаниеСписка"
//    - Таблица "СписокКонтрагентов"
//    - Кнопки: "ЗагрузитьСписок", "СохранитьСписок", "ДобавитьКонтрагента", "УдалитьКонтрагента"

// ===== ЧАСТЬ 4: ИНСТРУКЦИЯ ПО ИСПОЛЬЗОВАНИЮ =====

// ПОРЯДОК РАБОТЫ С ФОРМОЙ:
//
// 1. При открытии формы загружается список всех настроек
// 2. Выберите нужный список в таблице слева
// 3. Нажмите кнопку "Загрузить список" для редактирования
// 4. Добавьте/удалите контрагентов в таблице справа
// 5. Нажмите кнопку "Сохранить список" для сохранения изменений
//
// СОЗДАНИЕ НОВОГО СПИСКА:
//
// 1. Нажмите кнопку "Создать новый список"
// 2. Введите уникальный ключ (например, "Стр5_НовыеКонтрагенты")
// 3. Введите описание списка
// 4. Добавьте контрагентов
// 5. Сохраните список
//
// УДАЛЕНИЕ СПИСКА:
//
// 1. Выберите список в таблице слева
// 2. Нажмите кнопку "Удалить список"
// 3. Подтвердите удаление
