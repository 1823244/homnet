# Режим тестирования отчета ГР_26.01_2025

## Назначение

Режим тестирования позволяет проверить работу отчета без использования реальных контрагентов и специфических счетов бухгалтерского учета.

## Основные изменения в тестовом режиме

### 1. Счета бухгалтерского учета

**В обычном режиме** используются счета:
- `60311` - Кредиторская задолженность по информационно-технологическим услугам
- `60320` - Кредиторская задолженность по услугам депозитария
- `60322` - Кредиторская задолженность по прочим услугам
- `47403` - Кредиторская задолженность по начисленным процентам

**В режиме тестирования** все операции выполняются со счетом:
- `51` - Расчетные счета

### 2. Контрагенты

**В обычном режиме** используются реальные контрагенты из списков (хранятся в справочнике Показателей).

**В режиме тестирования** вместо контрагентов создаются тестовые банковские счета:
- `ТЕСТ_Счет1_ИТУслуги` (40702810100000000001) - для строки 1
- `ТЕСТ_Счет2_Аренда` (40702810200000000002) - для строки 2
- `ТЕСТ_Счет3_Депозитарии` (40702810300000000003) - для строки 3
- `ТЕСТ_Счет4_БанкГПБ` (40702810400000000004) - для строки 20

**Владелец счетов:** Организация с кодом `00-000001` (автоматически находится и устанавливается)

## Использование

### Включение режима тестирования

```bsl
// Обычный режим
СоздатьОбновитьПоказатели(Истина, Ложь);

// Режим тестирования
СоздатьОбновитьПоказатели(Истина, Истина);
```

**Параметры:**
1. `ВыводитьСообщения` - вывод диагностических сообщений
2. `РежимТестирования` - флаг режима тестирования

### Тестирование всех показателей

Для проверки расчета всех показателей отчета используйте процедуру `ТестироватьВсеПоказатели`:

```bsl
// Подключаем обработку
СсылкаОбработчика = Справочники.ДополнительныеОтчетыИОбработки
    .НайтиПоНаименованию("Отчет_ГР_26_01_2025", Истина);
ДополнительныеОтчетыИОбработки.ПодключитьВнешнююОбработку(СсылкаОбработчика);
ОбъектОбработки = ДополнительныеОтчетыИОбработки.ОбъектВнешнейОбработки(СсылкаОбработчика);

// Параметры
ДатаКол3 = Дата(2024, 12, 31);  // 31 декабря предыдущего года
ДатаКол4 = Дата(2025, 9, 30);   // Конец отчетного периода
Организация = Справочники.Организации.НайтиПоКоду("00-000001");

// Запуск тестирования
ОбъектОбработки.ТестироватьВсеПоказатели(ДатаКол3, ДатаКол4, Организация, Истина);
```

**Что делает процедура:**
- Вызывает вычисление показателей для всех 6 строк отчета
- Для каждой строки вычисляет 2 показателя (колонки 3 и 4)
- Выводит результаты в красиво оформленном виде
- Перехватывает и отображает ошибки

**Вывод процедуры тестирования:**
```
╔════════════════════════════════════════════════════════════════════════╗
║  ТЕСТИРОВАНИЕ ВСЕХ ПОКАЗАТЕЛЕЙ ОТЧЕТА ГР_26.01_2025                   ║
╠════════════════════════════════════════════════════════════════════════╣
║  Дата колонки 3: 31.12.2024                                           ║
║  Дата колонки 4: 30.09.2025                                           ║
║  Организация: ООО "Гранд"                                              ║
╚════════════════════════════════════════════════════════════════════════╝

┌────────────────────────────────────────────────────────────────────┐
│  СТРОКА  1                                                         │
├────────────────────────────────────────────────────────────────────┤
│  Колонка 3 (на 31.12.2024):                                       │
│    Значение:      1 234 567,89                                    │
│  Колонка 4 (на 30.09.2025):                                       │
│    Значение:      2 345 678,90                                    │
└────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────┐
│  СТРОКА  2                                                         │
├────────────────────────────────────────────────────────────────────┤
│  Колонка 3 (на 31.12.2024):                                       │
│    Значение:        123 456,78                                    │
│  Колонка 4 (на 30.09.2025):                                       │
│    Значение:        234 567,89                                    │
└────────────────────────────────────────────────────────────────────┘

... (для всех 6 строк) ...

╔════════════════════════════════════════════════════════════════════════╗
║  ТЕСТИРОВАНИЕ ЗАВЕРШЕНО                                                ║
╚════════════════════════════════════════════════════════════════════════╝
```

### Автоматическая инициализация

При первом запуске в режиме тестирования автоматически создаются:
- 4 тестовых банковских счета в справочнике `БанковскиеСчета`
- Показатели отчета с кодом, использующим счет 51

### Полный пример тестирования

```bsl
// ШАГ 1: Создание показателей в режиме тестирования
СоздатьОбновитьПоказатели(Истина, Истина);

// ШАГ 2: Подключение обработки для тестирования показателей
СсылкаОбработчика = Справочники.ДополнительныеОтчетыИОбработки
    .НайтиПоНаименованию("Отчет_ГР_26_01_2025", Истина);
ДополнительныеОтчетыИОбработки.ПодключитьВнешнююОбработку(СсылкаОбработчика);
ОбъектОбработки = ДополнительныеОтчетыИОбработки.ОбъектВнешнейОбработки(СсылкаОбработчика);

// ШАГ 3: Установка параметров
ДатаКол3 = Дата(2024, 12, 31);  // 31 декабря предыдущего года
ДатаКол4 = Дата(2025, 9, 30);   // Конец отчетного периода
Организация = Справочники.Организации.НайтиПоКоду("00-000001");

// ШАГ 4: Тестирование всех показателей
ОбъектОбработки.ТестироватьВсеПоказатели(ДатаКол3, ДатаКол4, Организация, Истина);
```

**Тестируемые строки отчета:**
- **Строка 1** - Кредиторская задолженность по информационно-технологическим услугам
- **Строка 2** - Кредиторская задолженность по услугам по содержанию и аренде помещений
- **Строка 3** - Кредиторская задолженность по услугам депозитария
- **Строка 10** - Итого кредиторская задолженность, оцениваемая по амортизированной стоимости
- **Строка 19** - Кредиторская задолженность по прочим финансовым обязательствам
- **Строка 20** - Прочее

**Для каждой строки вычисляются:**
- **Колонка 3** - Остаток на 31 декабря предыдущего года
- **Колонка 4** - Остаток на конец отчетного периода

**Итого:** 6 строк × 2 колонки = **12 показателей**

**Вывод в сообщениях:**
```
<operation_start>Начало создания показателей отчета ГР_26.01_2025 (РЕЖИМ ТЕСТИРОВАНИЯ)</operation_start>
<test_data_init>Начало инициализации тестовых данных</test_data_init>
<test_account_owner>Владелец счета: ООО "Гранд" (00-000001)</test_account_owner>
<test_account_created>Создан тестовый счет: ТЕСТ_Счет1_ИТУслуги (40702810100000000001)</test_account_created>
<test_account_owner>Владелец счета: ООО "Гранд" (00-000001)</test_account_owner>
<test_account_created>Создан тестовый счет: ТЕСТ_Счет2_Аренда (40702810200000000002)</test_account_created>
<test_account_owner>Владелец счета: ООО "Гранд" (00-000001)</test_account_owner>
<test_account_created>Создан тестовый счет: ТЕСТ_Счет3_Депозитарии (40702810300000000003)</test_account_created>
<test_account_owner>Владелец счета: ООО "Гранд" (00-000001)</test_account_owner>
<test_account_created>Создан тестовый счет: ТЕСТ_Счет4_БанкГПБ (40702810400000000004)</test_account_created>
<test_data_complete>Завершена инициализация тестовых данных</test_data_complete>
...
<operation_end>Завершено создание показателей отчета ГР_26.01_2025</operation_end>
```

⚠️ **Важно:** Если организация с кодом `00-000001` не найдена, будет выведено предупреждение:
```
<warning>Организация с кодом 00-000001 не найдена! Владелец счета не установлен.</warning>
```

## Технические детали

### Изменения в коде показателей

#### Вычисление показателя (пример для строки 1, колонки 3):

**Обычный режим:**
```bsl
СчетСсылка = ПланыСчетов.Хозрасчетный.НайтиПоКоду("60311");
СубконтоСсылка = ПолучитьКонтрагентов_Стр1_ИТУслуги(Ложь);
```

**Режим тестирования:**
```bsl
СчетСсылка = ПланыСчетов.Хозрасчетный.НайтиПоКоду("51");
СубконтоСсылка = ПолучитьТестовыеСчета("ТЕСТ_Счет1_ИТУслуги");
```

### Функция выбора счета

```bsl
Функция ПолучитьКодСчета(Знач КодСчета)
	
	Если мРежимТестирования Тогда
		Возврат "51";  // Всегда используем счет 51 в тестовом режиме
	Иначе
		Возврат КодСчета;  // Возвращаем исходный код счета
	КонецЕсли;
	
КонецФункции
```

### Текст кода показателя

В тестовом режиме генерируется следующий вызов:

```bsl
ЗначениеПоказателя = ДополнительныеОтчетыИОбработки.ОбъектВнешнейОбработки(СсылкаОбработчика)
	.ВычислитьПоказатель(1, 3, мНачалоПериода, мКонецПериода, СтруктураПараметров, Истина, Истина);
```

Последний параметр `Истина` указывает на режим тестирования.

## Проверка тестовых данных

### SQL-запрос для просмотра тестовых счетов:

```sql
SELECT 
    БанковскиеСчета.Наименование,
    БанковскиеСчета.НомерСчета,
    БанковскиеСчета.Владелец.Наименование КАК Организация,
    БанковскиеСчета.Владелец.Код КАК КодОрганизации
FROM 
    Справочник.БанковскиеСчета КАК БанковскиеСчета
WHERE 
    БанковскиеСчета.Наименование ПОДОБНО "ТЕСТ_%"
ORDER BY 
    БанковскиеСчета.Наименование
```

### Консольный скрипт для проверки:

```bsl
// Получение тестовых счетов
Счет1 = Справочники.БанковскиеСчета.НайтиПоНаименованию("ТЕСТ_Счет1_ИТУслуги", Истина);
Счет2 = Справочники.БанковскиеСчета.НайтиПоНаименованию("ТЕСТ_Счет2_Аренда", Истина);
Счет3 = Справочники.БанковскиеСчета.НайтиПоНаименованию("ТЕСТ_Счет3_Депозитарии", Истина);
Счет4 = Справочники.БанковскиеСчета.НайтиПоНаименованию("ТЕСТ_Счет4_БанкГПБ", Истина);

Сообщить("Счет 1: " + ?(ЗначениеЗаполнено(Счет1), "Найден", "НЕ НАЙДЕН"));
Если ЗначениеЗаполнено(Счет1) Тогда
	Сообщить("  Владелец: " + ?(ЗначениеЗаполнено(Счет1.Владелец), Строка(Счет1.Владелец) + " (" + Счет1.Владелец.Код + ")", "НЕ УСТАНОВЛЕН"));
КонецЕсли;

Сообщить("Счет 2: " + ?(ЗначениеЗаполнено(Счет2), "Найден", "НЕ НАЙДЕН"));
Если ЗначениеЗаполнено(Счет2) Тогда
	Сообщить("  Владелец: " + ?(ЗначениеЗаполнено(Счет2.Владелец), Строка(Счет2.Владелец) + " (" + Счет2.Владелец.Код + ")", "НЕ УСТАНОВЛЕН"));
КонецЕсли;

Сообщить("Счет 3: " + ?(ЗначениеЗаполнено(Счет3), "Найден", "НЕ НАЙДЕН"));
Если ЗначениеЗаполнено(Счет3) Тогда
	Сообщить("  Владелец: " + ?(ЗначениеЗаполнено(Счет3.Владелец), Строка(Счет3.Владелец) + " (" + Счет3.Владелец.Код + ")", "НЕ УСТАНОВЛЕН"));
КонецЕсли;

Сообщить("Счет 4: " + ?(ЗначениеЗаполнено(Счет4), "Найден", "НЕ НАЙДЕН"));
Если ЗначениеЗаполнено(Счет4) Тогда
	Сообщить("  Владелец: " + ?(ЗначениеЗаполнено(Счет4.Владелец), Строка(Счет4.Владелец) + " (" + Счет4.Владелец.Код + ")", "НЕ УСТАНОВЛЕН"));
КонецЕсли;

// Проверка организации
Организация = Справочники.Организации.НайтиПоКоду("00-000001");
Сообщить("");
Сообщить("Организация 00-000001: " + ?(ЗначениеЗаполнено(Организация), "Найдена - " + Строка(Организация), "НЕ НАЙДЕНА"));
```

## Удаление тестовых данных

После завершения тестирования можно удалить тестовые счета:

```bsl
Процедура УдалитьТестовыеСчета()
	
	МассивНаименований = Новый Массив;
	МассивНаименований.Добавить("ТЕСТ_Счет1_ИТУслуги");
	МассивНаименований.Добавить("ТЕСТ_Счет2_Аренда");
	МассивНаименований.Добавить("ТЕСТ_Счет3_Депозитарии");
	МассивНаименований.Добавить("ТЕСТ_Счет4_БанкГПБ");
	
	Для Каждого Наименование Из МассивНаименований Цикл
		
		СчетСсылка = Справочники.БанковскиеСчета.НайтиПоНаименованию(Наименование, Истина);
		
		Если ЗначениеЗаполнено(СчетСсылка) Тогда
			Попытка
				СчетОбъект = СчетСсылка.ПолучитьОбъект();
				СчетОбъект.Удалить();
				Сообщить("Удален тестовый счет: " + Наименование);
			Исключение
				Сообщить("Ошибка удаления счета " + Наименование + ": " + ОписаниеОшибки());
			КонецПопытки;
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры
```

## Требования

⚠️ **Перед использованием режима тестирования:**

В справочнике `Организации` должна существовать организация с кодом `00-000001`

Если организация не найдена:
- Тестовые счета будут созданы без владельца
- Будет выведено предупреждение в сообщениях
- Работоспособность отчета может быть нарушена (если справочник БанковскиеСчета требует обязательного заполнения владельца)

## Преимущества режима тестирования

✅ **Независимость от реальных данных**  
Не требуется настройка реальных контрагентов и специфических счетов

✅ **Быстрая проверка**  
Можно быстро проверить работу отчета на типовых счетах (счет 51)

✅ **Безопасность**  
Тестовые данные не влияют на реальные показатели

✅ **Удобство отладки**  
Легко создавать тестовые проводки по счету 51 для проверки расчетов

✅ **Корректный владелец**  
Все тестовые счета автоматически привязываются к организации с кодом 00-000001

## Ограничения

⚠️ **Режим тестирования НЕ подходит для:**
- Формирования официальной отчетности
- Проверки реальных бизнес-показателей
- Расчета фактических значений кредиторской задолженности

⚠️ **В тестовом режиме:**
- Все счета заменяются на счет 51
- Контрагенты заменяются на банковские счета
- Результаты могут отличаться от реальных

## Рекомендации

1. **Используйте режим тестирования для:**
   - Проверки логики создания показателей
   - Отладки формул и алгоритмов
   - Обучения работе с отчетом

2. **НЕ используйте для:**
   - Формирования реальных отчетов
   - Принятия управленческих решений
   - Проверки реальных финансовых данных

---

---

## Справка по API

### Процедура: `ТестироватьВсеПоказатели`

**Назначение:** Вызов всех функций вычисления показателей отчета в режиме тестирования

**Синтаксис:**
```bsl
ТестироватьВсеПоказатели(ДатаКол3, ДатаКол4, Организация, ВыводитьСообщения)
```

**Параметры:**

| Параметр | Тип | Описание |
|----------|-----|----------|
| `ДатаКол3` | Дата | Дата для колонки 3 (обычно 31 декабря предыдущего года) |
| `ДатаКол4` | Дата | Дата для колонки 4 (конец отчетного периода) |
| `Организация` | СправочникСсылка.Организации | Организация для расчета показателей |
| `ВыводитьСообщения` | Булево | Флаг вывода результатов (по умолчанию Истина) |

**Возвращаемое значение:** Отсутствует (процедура)

**Что делает:**
1. Формирует структуру параметров с указанной организацией
2. Последовательно вызывает `ВычислитьПоказатель()` для всех 12 показателей
3. Использует режим тестирования (счет 51, тестовые банковские счета)
4. Выводит результаты в оформленном виде с рамками
5. Перехватывает ошибки и выводит их описание

**Обрабатываемые показатели:**
- Строка 1, колонки 3 и 4
- Строка 2, колонки 3 и 4
- Строка 3, колонки 3 и 4
- Строка 10, колонки 3 и 4
- Строка 19, колонки 3 и 4
- Строка 20, колонки 3 и 4

**Пример использования:**
```bsl
ДатаКол3 = Дата(2024, 12, 31);
ДатаКол4 = Дата(2025, 9, 30);
Организация = Справочники.Организации.НайтиПоКоду("00-000001");
ТестироватьВсеПоказатели(ДатаКол3, ДатаКол4, Организация, Истина);
```

**Особенности:**
- Автоматически включается режим тестирования (последний параметр = Истина)
- Не требует предварительного создания показателей
- Безопасна для запуска - не изменяет данные, только читает
- Все ошибки перехватываются и не прерывают выполнение

---

**Готово к тестированию! 🧪**
