# Сравнение вариантов хранения списков контрагентов

## Общая информация

Задача: Хранение списков контрагентов для разных строк отчета ГР_26.01_2025 с возможностью редактирования без входа в конфигуратор.

---

## Вариант 1: Хранение в справочнике Показателей

### Принцип работы
- Создаются специальные элементы справочника с префиксом `СПИСОК_КОНТРАГЕНТОВ_`
- Список контрагентов хранится в табличной части `ИспользуемыеПоказатели`
- Для каждого контрагента создается элемент-маркер
- Маркеры хранят наименование контрагента в реквизите `ОписаниеПоказателя`

### Преимущества ✅
1. **Структурированное хранение** - данные в справочнике БД
2. **Видимость в конфигураторе** - можно просмотреть в режиме предприятия и конфигуратора
3. **Стандартные формы** - можно использовать типовые формы справочника
4. **Интеграция с системой** - данные являются частью конфигурации
5. **Резервное копирование** - автоматически включается в бэкап БД
6. **Права доступа** - можно настроить через RLS на уровне справочника
7. **История изменений** - можно отследить через механизмы 1С

### Недостатки ❌
1. **Дополнительные элементы** - создается много элементов-маркеров (засорение справочника)
2. **Сложность реализации** - требуется создание маркеров для каждого контрагента
3. **Производительность** - множественные операции чтения/записи
4. **Сложность удаления** - нужно удалять маркеры при удалении списка
5. **Требуется форма** - нужна специальная форма для удобного редактирования

### Код инициализации
```bsl
ИнициализироватьСпискиКонтрагентовВСправочнике();
```

### Код получения списка
```bsl
МассивКонтрагентов = ПолучитьСписокКонтрагентовИзСправочника("Стр1_ИТУслуги");
```

---

## Вариант 2: Хранение в Хранилище Общих Настроек ⭐ РЕКОМЕНДУЕТСЯ

### Принцип работы
- Используется стандартный механизм `ХранилищеОбщихНастроек`
- Ключ объекта: `ГР_26_01_2025`
- Ключ настроек: идентификатор списка (например, `Стр1_ИТУслуги`)
- Значение: структура с описанием, датой изменения и массивом контрагентов

### Преимущества ✅
1. **Простота реализации** - стандартный механизм 1С, минимум кода
2. **Чистота справочника** - не создает лишних элементов
3. **Высокая производительность** - быстрая запись/чтение
4. **Гибкость хранения** - можно добавлять любые дополнительные поля
5. **Легкое управление** - простые операции добавления/удаления списков
6. **Автодоступность** - доступно всем пользователям по умолчанию
7. **Не требует изменений** - работает без изменения конфигурации
8. **Метаданные** - можно хранить описание, дату изменения, автора и т.д.
9. **Список настроек** - легко получить список всех сохраненных списков
10. **Простое удаление** - одна команда удаляет весь список

### Недостатки ❌
1. **Не видно в конфигураторе** - данные скрыты от прямого просмотра
2. **Права доступа** - сложнее настроить индивидуальные права (только через RLS БД)
3. **Требуется обработка** - нужна форма для просмотра и редактирования

### Структура хранения
```bsl
Настройки = Новый Структура;
Настройки.Вставить("Описание", "Контрагенты по ИТ-услугам");
Настройки.Вставить("ДатаИзменения", ТекущаяДата());
Настройки.Вставить("Контрагенты", МассивКонтрагентовСтруктур);

// Каждый контрагент:
КонтрагентСтруктура = Новый Структура;
КонтрагентСтруктура.Вставить("Наименование", "АБИСОФТ ООО");
КонтрагентСтруктура.Вставить("Ссылка", СсылкаНаКонтрагента);
```

### Код инициализации
```bsl
ИнициализироватьСпискиКонтрагентовВХранилище();
```

### Код получения списка
```bsl
МассивКонтрагентов = ПолучитьСписокКонтрагентовИзХранилища("Стр1_ИТУслуги");
```

### Дополнительные возможности
```bsl
// Получить список всех настроек
СписокВсехНастроек = ПолучитьСписокВсехНастроекКонтрагентов();

// Удалить список
УдалитьСписокКонтрагентовИзХранилища("Стр1_ИТУслуги");

// Сохранить новый список
МассивКонтрагентов = Новый Массив;
МассивКонтрагентов.Добавить(Контрагент1);
СохранитьСписокКонтрагентовВХранилище("НовыйСписок", МассивКонтрагентов, "Описание");
```

---

## Сравнительная таблица

| Критерий | Вариант 1 (Справочник) | Вариант 2 (Хранилище) ⭐ |
|----------|------------------------|-------------------------|
| **Простота реализации** | ⚠️ Средняя | ✅ Высокая |
| **Количество кода** | ⚠️ Много | ✅ Мало |
| **Производительность** | ⚠️ Средняя | ✅ Высокая |
| **Чистота справочника** | ❌ Создает элементы | ✅ Не создает |
| **Видимость данных** | ✅ Видно в конфигураторе | ⚠️ Нужна обработка |
| **Гибкость хранения** | ⚠️ Ограничена | ✅ Полная |
| **Легкость редактирования** | ⚠️ Требует форму | ✅ Простая форма |
| **Права доступа** | ✅ Через RLS справочника | ⚠️ Через RLS БД |
| **Удаление списков** | ⚠️ Сложное | ✅ Простое |
| **Резервное копирование** | ✅ Автоматическое | ✅ Автоматическое |
| **Интеграция с системой** | ✅ Часть конфигурации | ⚠️ Внешние данные |
| **Поддержка метаданных** | ⚠️ Ограничена | ✅ Любые поля |

---

## Рекомендация: ВАРИАНТ 2 (Хранилище общих настроек)

### Почему Вариант 2?

1. **Простота** - минимум кода, стандартный механизм 1С
2. **Производительность** - быстрые операции чтения/записи
3. **Чистота** - не засоряет справочник показателей
4. **Гибкость** - легко добавлять новые поля и списки
5. **Удобство** - простая форма редактирования
6. **Масштабируемость** - легко добавлять новые списки

### Когда использовать Вариант 1?

- Если критически важна видимость данных в конфигураторе
- Если требуется интеграция с другими механизмами справочника
- Если нужны специфичные права доступа на уровне справочника
- Если важна история изменений через стандартные механизмы 1С

---

## Инструкция по внедрению Варианта 2

### Шаг 1: Добавить процедуры в модуль обработки
Скопировать код из файла `Вариант2_ХранениеВХранилищеНастроек.bsl`

### Шаг 2: Выполнить инициализацию
```bsl
ИнициализироватьСпискиКонтрагентовВХранилище();
```

### Шаг 3: Заменить функции получения контрагентов
Функции типа `ПолучитьКонтрагентов_Стр1_ИТУслуги()` теперь используют хранилище.

### Шаг 4: Создать форму редактирования (опционально)
- Создать внешнюю обработку
- Добавить код из файла `Форма_РедактированияСписковКонтрагентов.bsl`
- Настроить элементы формы согласно описанию

### Шаг 5: Предоставить доступ пользователям
Пользователи смогут:
- Просматривать списки контрагентов
- Редактировать существующие списки
- Создавать новые списки
- Удалять ненужные списки

Всё это без входа в конфигуратор!

---

## Миграция данных

Если нужно перенести данные из Варианта 1 в Вариант 2:

```bsl
Процедура МигрироватьДанныеИзСправочникаВХранилище()
	
	// Получаем все списки из справочника
	МассивКлючей = Новый Массив;
	МассивКлючей.Добавить("Стр1_ИТУслуги");
	МассивКлючей.Добавить("Стр2_АрендаПомещений");
	МассивКлючей.Добавить("Стр3_Депозитарии");
	МассивКлючей.Добавить("Стр20_БанкГПБ");
	
	Для Каждого Ключ Из МассивКлючей Цикл
		
		// Получаем из справочника
		МассивКонтрагентов = ПолучитьСписокКонтрагентовИзСправочника(Ключ);
		
		// Сохраняем в хранилище
		Если МассивКонтрагентов.Количество() > 0 Тогда
			СохранитьСписокКонтрагентовВХранилище(Ключ, МассивКонтрагентов, "Мигрировано из справочника");
		КонецЕсли;
		
	КонецЦикла;
	
	Сообщить("Миграция завершена");
	
КонецПроцедуры
```

---

## Заключение

**Вариант 2 (Хранилище общих настроек)** является оптимальным выбором для задачи хранения списков контрагентов:
- ✅ Простота реализации и поддержки
- ✅ Высокая производительность
- ✅ Удобство использования
- ✅ Гибкость и масштабируемость

Вариант 1 можно рассматривать только при специфических требованиях к интеграции со справочником.
